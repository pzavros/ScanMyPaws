import{e as J,j as e,b as C,r as d,c as m,B as x,S as Y,a4 as K,a5 as T,I as M}from"./index-BkwN6ugi.js";import{P as Q}from"./Page-nSfMCqEi.js";import{E as X}from"./Edit-DyYhkn_S.js";import{a as q,b as P,c as W,e as U,f as Z,D as ee,d as re,A as oe}from"./dateUtils-Dhw2N_wR.js";import{B as b}from"./Button-CqxvuVq1.js";import{I as j}from"./InputField-BHtlVtRS.js";import{G as $}from"./Grid-CFPI6i8Q.js";import{C as te}from"./Card-qR-nIDCf.js";import{C as ne}from"./CardContent-DNEzsCUe.js";import"./TextField-Xo4kt7zH.js";import"./Grow-CBhhKj-Z.js";import"./isHostComponent-DVu5iVWx.js";import"./isMuiElement-BIwZpEg9.js";import"./Select-CVW7Cr0N.js";import"./List-CSE9cjs2.js";const z=J(e.jsx("path",{d:"M17 12h-5v5h5zM16 1v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2h-1V1zm3 18H5V8h14z"}),"Event"),y="http://localhost:5001",L=()=>{const o=localStorage.getItem("token");if(!o)return null;try{return JSON.parse(atob(o.split(".")[1])).UserID||null}catch(t){return console.error("Error decoding token:",t),null}},se=async()=>{const o=L();if(!o)return console.error("User ID is missing. Please log in."),[];try{return(await C.get(`${y}/api/schedules/user/${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch(t){return console.error("Error fetching schedules:",t),[]}},ae=async o=>{var t;try{return(await C.post(`${y}/api/schedules`,o,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})).data}catch(n){throw console.error("Error creating schedule:",((t=n.response)==null?void 0:t.data)||n.message),n}},R=async o=>{var t;if(!o||!o.scheduleID)throw console.error("Error: Schedule ID is missing in update request",o),new Error("Schedule ID is required for update.");try{return await C.put(`${y}/api/schedules/${o.scheduleID}`,{scheduleDto:{scheduleID:o.scheduleID,userID:o.userID,title:o.title,date:o.date,time:o.time,description:o.description,isCompleted:o.isCompleted}},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})}catch(n){throw console.error("Error updating schedule:",((t=n.response)==null?void 0:t.data)||n.message),n}},ie=async o=>{var t;if(!o)throw console.error("Error: Schedule ID is missing in delete request"),new Error("Schedule ID is required for deletion.");try{return await C.delete(`${y}/api/schedules/${o}`,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),{success:!0}}catch(n){throw console.error("Error deleting schedule:",((t=n.response)==null?void 0:t.data)||n.message),n}},le=({isOpen:o,onClose:t,onSave:n,selectedSchedule:s})=>{const[c,p]=d.useState({title:"",date:"",time:"",description:""});d.useEffect(()=>{s&&p({title:s.title||"",date:s.date?s.date.split("T")[0]:"",time:s.time||"",description:s.description||""})},[s]);const g=i=>{p({...c,[i.target.name]:i.target.value})},D=async()=>{const i={scheduleID:(s==null?void 0:s.scheduleID)??0,userID:parseInt(L()),title:c.title,date:new Date(c.date).toISOString(),time:c.time+":00",description:c.description};try{let l;if(s?l=await R(i):l=await ae(i),!l||!l.scheduleID){console.error("Schedule creation failed, invalid scheduleID:",l);return}n({...l,scheduleID:l.scheduleID}),p({title:"",date:"",time:"",description:""}),t(),window.location.reload()}catch(l){console.error("Failed to save schedule:",l)}};return e.jsxs(q,{open:o,onClose:t,maxWidth:"sm",fullWidth:!0,sx:{"& .MuiPaper-root":{backgroundColor:"var(--background-color)",color:"var(--text-color)"}},children:[e.jsx(P,{sx:{backgroundColor:"var(--background-color)",color:"var(--text-color)"},children:e.jsx(m,{variant:"h6",component:"div",fontWeight:"bold",children:s?"Edit Schedule":"Add New Schedule"})}),e.jsx(W,{sx:{backgroundColor:"var(--background-color)",color:"var(--text-color)"},children:e.jsxs(x,{sx:{display:"flex",flexDirection:"column",gap:2,p:2},children:[e.jsx(j,{label:"Title",name:"title",value:c.title,onChange:g,fullWidth:!0,required:!0,sx:{"& .MuiInputBase-root":{color:"var(--text-color)"},"& .MuiInputLabel-root":{color:"var(--text-color)"}}}),e.jsx(j,{name:"date",type:"date",value:c.date,onChange:g,fullWidth:!0,required:!0,sx:{"& .MuiInputBase-root":{color:"var(--text-color)"},"& .MuiInputLabel-root":{color:"var(--text-color)"}}}),e.jsx(j,{name:"time",type:"time",value:c.time,onChange:g,fullWidth:!0,required:!0,sx:{"& .MuiInputBase-root":{color:"var(--text-color)"},"& .MuiInputLabel-root":{color:"var(--text-color)"}}}),e.jsx(j,{label:"Description",name:"description",value:c.description,onChange:g,fullWidth:!0,multiline:!0,rows:3,sx:{"& .MuiInputBase-root":{color:"var(--text-color)"},"& .MuiInputLabel-root":{color:"var(--text-color)"}}})]})}),e.jsxs(U,{sx:{padding:2,backgroundColor:"var(--background-color)",color:"var(--text-color)"},children:[e.jsx(b,{onClick:t,variant:"outlined",children:"Cancel"}),e.jsx(b,{onClick:D,variant:"primary",children:s?"Update":"Save"})]})]})},ce=()=>{const[o,t]=d.useState([]),[n,s]=d.useState([]),[c,p]=d.useState([]),[g,D]=d.useState(!1),[i,l]=d.useState(null),[H,w]=d.useState(!1),[v,N]=d.useState(0);d.useEffect(()=>{(async()=>{try{const a=await se(),f=new Date,u=a.filter(h=>{const I=new Date(h.date),[k,E,A]=h.time.split(":").map(Number);return I.setHours(k,E,A),I<f}),F=a.filter(h=>{const I=new Date(h.date),[k,E,A]=h.time.split(":").map(Number);return I.setHours(k,E,A),I>=f});s(u),p(F),t(a)}catch(a){console.error("Error fetching schedules:",a)}})()},[]);const O=r=>{l(r),w(!0)},B=()=>{w(!1),l(null)},V=async r=>{var f;if(!r||!r.scheduleID){console.error(" Error: Invalid schedule update request!",r);return}const a={scheduleID:r.scheduleID,userID:r.userID,title:r.title,date:r.date,time:typeof r.time=="string"?r.time:r.time.toString(),description:r.description,isCompleted:r.isCompleted};try{console.log("Sending update request with:",a);const u=await R(a);console.log("Update API Response:",u),u.status===200?(t(F=>F.map(h=>h.scheduleID===r.scheduleID?r:h)),B(),window.location.reload()):console.error("Unexpected response from update API:",u)}catch(u){console.error("Error updating schedule:",((f=u.response)==null?void 0:f.data)||u.message)}},_=r=>{if(!r||!r.scheduleID){console.error("Error: Schedule ID is undefined!",r);return}console.log(`Deleting schedule ID: ${r.scheduleID}`),l(r),D(!0)},S=()=>{D(!1),l(null)},G=async()=>{if(!i||!i.scheduleID){console.error("Error: Trying to delete a schedule with an undefined ID");return}try{console.log(`Sending DELETE request for scheduleID: ${i.scheduleID}`),await ie(i.scheduleID),p(r=>r.filter(a=>a.scheduleID!==i.scheduleID)),s(r=>r.filter(a=>a.scheduleID!==i.scheduleID)),t(r=>r.filter(a=>a.scheduleID!==i.scheduleID)),console.log(`Schedule ${i.scheduleID} deleted successfully.`)}catch(r){console.error("Error deleting schedule:",r)}finally{S()}};return e.jsxs(Y,{children:[e.jsxs(x,{textAlign:"center",marginBottom:4,children:[e.jsx(x,{sx:{display:"inline-flex",justifyContent:"center",alignItems:"center",width:60,height:60,background:"linear-gradient(135deg, #FFC1A1, #FF6F61)",borderRadius:"50%",marginBottom:1,boxShadow:"0 4px 10px rgba(0, 0, 0, 0.1)"},children:e.jsx(z,{sx:{color:"#fff",fontSize:"1.8rem"}})}),e.jsx(m,{variant:"h5",fontWeight:"bold",color:"var(--text-color)",marginBottom:1,children:"My Schedules"})]}),e.jsxs(K,{value:v,onChange:(r,a)=>N(a),centered:!0,sx:{"& .MuiTabs-indicator":{backgroundColor:"#FF6F61"},"& .MuiTab-root":{color:"var(--text-color)"},"& .Mui-selected":{color:"#FF6F61 !important",backgroundColor:"transparent !important"}},children:[e.jsx(T,{label:"Upcoming Schedules"}),e.jsx(T,{label:"Past Schedules"})]}),e.jsx($,{container:!0,spacing:3,sx:{marginTop:2},children:v===0&&c.length===0?e.jsx(x,{sx:{width:"100%",textAlign:"center",marginTop:4},children:e.jsx(m,{variant:"h6",sx:{color:"var(--text-color)",fontStyle:"italic"},children:"No upcoming schedules."})}):v===1&&n.length===0?e.jsx(x,{sx:{width:"100%",textAlign:"center",marginTop:4},children:e.jsx(m,{variant:"h6",sx:{color:"var(--text-color)",fontStyle:"italic"},children:"No past schedules."})}):(v===0?c:n).map(r=>e.jsx($,{item:!0,xs:12,sm:6,md:4,children:e.jsx(te,{sx:{position:"relative",background:"linear-gradient(135deg, #FFB7C5, #92E6FF)",borderRadius:"16px",boxShadow:"0 10px 20px rgba(0, 0, 0, 0.15)",overflow:"hidden",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-5px)",boxShadow:"0 20px 30px rgba(0, 0, 0, 0.25)"}},children:e.jsxs(ne,{sx:{position:"relative",zIndex:2,padding:2},children:[e.jsx(x,{sx:{display:"flex",justifyContent:"center",alignItems:"center",width:40,height:40,background:"linear-gradient(135deg, #FFC1A1, #FF6F61)",borderRadius:"50%",margin:"0 auto 10px",boxShadow:"0 3px 8px rgba(0, 0, 0, 0.1)"},children:e.jsx(z,{sx:{color:"#fff",fontSize:"1.2rem"}})}),e.jsx(m,{variant:"h6",fontWeight:"bold",textAlign:"center",color:"var(--text-color)",marginBottom:.5,children:r.title}),e.jsx(m,{variant:"body2",textAlign:"center",fontStyle:"italic",color:"var(--text-color)",marginBottom:1,children:Z(r.date)}),e.jsxs(x,{sx:{position:"absolute",top:10,right:10,display:"flex",gap:1},children:[e.jsx(M,{onClick:()=>O(r),sx:{background:"rgba(255, 255, 255, 0.3)",color:"#FF6F61","&:hover":{background:"#FFAB91"}},children:e.jsx(X,{})}),e.jsx(M,{onClick:()=>_(r),sx:{background:"rgba(255, 255, 255, 0.3)",color:"#FF6F61","&:hover":{background:"#FFAB91"}},children:e.jsx(ee,{})})]})]})})},r.scheduleID))}),e.jsxs(q,{open:g,onClose:S,children:[e.jsx(P,{children:"Confirm Deletion"}),e.jsx(W,{children:e.jsx(re,{children:"Are you sure you want to delete this schedule? This action cannot be undone."})}),e.jsxs(U,{children:[e.jsx(b,{onClick:S,variant:"outlined",children:"Cancel"}),e.jsx(b,{onClick:G,variant:"contained",color:"error",children:"Confirm"})]})]}),e.jsx(le,{isOpen:H,onClose:B,onSave:V,selectedSchedule:i}),e.jsx(b,{onClick:()=>{l(null),w(!0)},sx:{position:"fixed",bottom:"20px",right:"20px",minWidth:"56px",width:"56px",height:"56px",borderRadius:"50%",padding:0,background:"linear-gradient(90deg, rgba(255,111,97,1) 0%, rgba(255,165,97,1) 100%)",color:"#fff",borderRadius:"50px","&:hover":{background:"linear-gradient(90deg, rgba(255,165,97,1) 0%, rgba(255,111,97,1) 100%)"}},children:e.jsx(oe,{sx:{fontSize:"2rem"}})})]})},we=()=>e.jsx(Q,{children:e.jsx(ce,{})});export{we as default};
