import{f as k,r as d,j as a,B as l,c as u,P as w,a as y}from"./index-BkwN6ugi.js";import{P as I}from"./Page-nSfMCqEi.js";import{f as C,m as j,b as S}from"./api-Dn10Jbrv.js";import{T as R}from"./TextField-Xo4kt7zH.js";import"./Grow-CBhhKj-Z.js";import"./isHostComponent-DVu5iVWx.js";import"./isMuiElement-BIwZpEg9.js";import"./Select-CVW7Cr0N.js";import"./List-CSE9cjs2.js";class c extends Error{}c.prototype.name="InvalidTokenError";function T(o){return decodeURIComponent(atob(o).replace(/(.)/g,(r,s)=>{let t=s.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}function M(o){let r=o.replace(/-/g,"+").replace(/_/g,"/");switch(r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return T(r)}catch{return atob(r)}}function E(o,r){if(typeof o!="string")throw new c("Invalid token specified: must be a string");r||(r={});const s=r.header===!0?0:1,t=o.split(".")[s];if(typeof t!="string")throw new c(`Invalid token specified: missing part #${s+1}`);let i;try{i=M(t)}catch(n){throw new c(`Invalid token specified: invalid base64 for part #${s+1} (${n.message})`)}try{return JSON.parse(i)}catch(n){throw new c(`Invalid token specified: invalid json for part #${s+1} (${n.message})`)}}const z=()=>{const{sessionId:o}=k(),[r,s]=d.useState([]),[t,i]=d.useState(""),n=d.useRef(null),p=d.useRef(!1),h=localStorage.getItem("token");let f=null;if(h)try{const e=E(h);f=String(e.UserID)}catch(e){console.error("Invalid token:",e)}d.useEffect(()=>{g();const e=setInterval(g,3e3);return()=>clearInterval(e)},[o]);const g=async()=>{try{const e=await C(o);s(e),await j(o),p.current&&(b(),p.current=!1)}catch(e){console.error("Error loading messages:",e)}},m=async()=>{if(t.trim())try{p.current=!0,await S(o,t),i(""),g()}catch(e){console.error("Error sending message:",e)}},b=()=>{var e;(e=n.current)==null||e.scrollTo({top:n.current.scrollHeight,behavior:"smooth"})};return a.jsx(I,{children:a.jsxs(l,{sx:{display:"flex",flexDirection:"column",height:"100vh",maxWidth:"600px",backgroundColor:"var(--background-color)",color:"var(--text-color)",boxShadow:"0px 4px 10px rgba(0, 0, 0, 0.2)"},children:[a.jsx(l,{ref:n,sx:{flex:1,padding:"70px 16px 80px",overflowY:"auto",backgroundColor:"var(--card-background)",borderRadius:"8px",position:"relative"},children:r.length===0?a.jsx(u,{variant:"body2",sx:{textAlign:"center",opacity:.6},children:"No messages yet."}):r.map((e,v)=>{const x=String(e.senderId)===f;return a.jsx(l,{sx:{display:"flex",flexDirection:x?"row-reverse":"row",alignItems:"center",mb:1},children:a.jsxs(w,{sx:{padding:"8px 12px",borderRadius:"16px",backgroundColor:x?"#1976d2":"#e0e0e0",color:x?"#fff":"#000",maxWidth:"75%",wordBreak:"break-word",boxShadow:"2px 2px 5px rgba(0,0,0,0.1)",position:"relative"},children:[a.jsx(u,{variant:"body1",children:e.messageContent}),a.jsx(u,{variant:"caption",sx:{display:"block",textAlign:"right",opacity:.7,fontSize:"0.75rem",marginTop:"4px"},children:e.sentAt})]})},v)})}),a.jsxs(l,{sx:{position:"fixed",bottom:0,left:0,right:0,display:"flex",gap:1,padding:"10px",backgroundColor:"var(--background-color)",borderTop:"1px solid #ddd",zIndex:1e3},children:[a.jsx(R,{fullWidth:!0,variant:"outlined",placeholder:"Type your message...",value:t,onChange:e=>i(e.target.value),sx:{backgroundColor:"var(--input-background)",borderRadius:"25px","& .MuiOutlinedInput-root":{borderRadius:"25px",paddingLeft:"12px"}}}),a.jsx(y,{variant:"contained",onClick:m,sx:{borderRadius:"50px",padding:"12px 20px",backgroundColor:"#1976d2","&:hover":{backgroundColor:"#1565c0"}},children:"Send"})]})]})})};export{z as default};
